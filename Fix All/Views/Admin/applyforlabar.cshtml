@model IEnumerable<Fix_All.Models.ServiceProvider>

@{
    Layout = "~/Views/Shared/_Admin_layout.cshtml";
    ViewData["Title"] = "Service Providers";
}

<div class="card shadow-sm p-3">
    <h2 class="mb-3">Service Providers</h2>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-info">@TempData["Message"]</div>
    }

    <!-- Top Scrollbar -->
    <div id="top-scroll" style="overflow-x:auto; height:16px;">
        <div style="height:1px;"></div> <!-- dummy div to generate scrollbar -->
    </div>

    <!-- Main Scroll Wrapper -->
    <div id="main-scroll" style="overflow-x:auto; max-height:500px;">
        <table class="table table-hover table-bordered text-dark">
            <thead class="table-dark sticky-header">
                <tr>
                    <th>ID</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>CNIC</th>
                    <th>Education</th>
                    <th>Field</th>
                    <th>Experience</th>
                    <th>CV</th>
                    
                    <th style="width:200px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.LarberId</td>
                        <td>@item.FirstName @item.LastName</td>
                        <td>@item.Email</td>
                        <td>@item.Phone</td>
                        <td>@item.CNIC</td>
                        <td>@item.Education</td>
                        <td>@item.LaborField?.FieldName ?? item.addmorefield</td>
                        <td>@item.Experience</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.CVFilePath))
                            {
                                <a href="@Url.Content(item.CVFilePath)" target="_blank" class="btn btn-link btn-sm">View CV</a>
                            }
                        </td>
                        
                        <td>
                            <form asp-action="Approve" asp-route-id="@item.LarberId" method="post" class="d-inline">
                                <button type="submit" class="btn btn-success btn-sm">Approve</button>
                            </form>

                            <!-- Reject Button (opens modal instead of directly posting form) -->
                            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal-@item.LarberId">
                                Reject
                            </button>
                            <!-- Bootstrap Delete Confirmation Modal -->
                            <div class="modal fade" id="confirmDeleteModal-@item.LarberId" tabindex="-1" aria-labelledby="deleteModalLabel-@item.LarberId" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">

                                        <div class="modal-header">
                                            <h5 class="modal-title" id="deleteModalLabel-@item.LarberId">Confirm Delete</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>

                                        <div class="modal-body">
                                            Are you sure you want to <b>Reject</b> this Service Provider (ID: @item.LarberId)?
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>

                                            <!-- Form submit only on confirm -->
                                            <form asp-action="Reject" asp-route-id="@item.LarberId" method="post" class="d-inline">
                                                <button type="submit" class="btn btn-danger">Yes, Reject</button>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>


                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<style>
    /* Force table text to always be black */
    .table td, .table th {
        color: black !important;
        white-space: nowrap;
    }

    /* Sticky header */
    .sticky-header th {
        position: sticky;
        top: 0;
        z-index: 10;
        background: #212529; /* Bootstrap dark */
        color: #fff !important;
    }
</style>

<script>
    const topScroll = document.getElementById("top-scroll");
    const mainScroll = document.getElementById("main-scroll");

    // Sync scrolling between top and main scrollbar
    topScroll.addEventListener("scroll", () => {
        mainScroll.scrollLeft = topScroll.scrollLeft;
    });

    mainScroll.addEventListener("scroll", () => {
        topScroll.scrollLeft = mainScroll.scrollLeft;
    });

    // Adjust top scrollbar width to match table
    window.addEventListener("load", () => {
        topScroll.firstElementChild.style.width = mainScroll.scrollWidth + "px";
    });
</script>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap JS (modal support) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
